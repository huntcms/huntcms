{% include "../../header.html" %} {% include "../../navigation.html" %}



<div class="wrapper">
    <div class="container-fluid">

        <!-- Page-Title -->
        <div class="row">
            <div class="col-sm-12">
                <div class="page-title-box">
                    <div class="btn-group pull-right">
                        <h4 class="page-title">Edit TypeFilter</h4>
                    </div>
                    <ol class="breadcrumb hide-phone p-0 m-0">
                        <li class="breadcrumb-item">
                            <a href="#">HuntCMS</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="#">TypeFilter</a>
                        </li>
                        <li class="breadcrumb-item active">Edit TypeFilter</li>
                    </ol>
                </div>
            </div>
        </div>
        <!-- end page title end breadcrumb -->

        <div class="row">
            <div class="col-12">
                <div class="card-box">
                    <h4 class="m-t-0 header-title">Edit TypeFilter</h4>
                    <p class="text-muted m-b-30 font-14">
                        User can edit shop TypeFilter.
                    </p>

                    <div class="row">
                        <div class="col-12">
                            <div class="p-20">
                                    <div class="form-group row">
                                            <label class="col-2 col-form-label">Id</label>
                                            <div class="col-10">
                                                <input type="text" class="form-control" required id="id" name="id" readonly="readonly" placeholder="Some text value..." value="{{ type.id }}">
                                            </div>
                                        </div>

                                    <div class="form-group row">
                                        <label class="col-2 col-form-label">Type</label>
                                        <div class="col-10">
                                            <select class="form-control" name="type_id" required id="type_id" onchange="onUpdate(false);">
                                                {% for property in types%}
                                                <option value="{{property.id}}"{% if property.id == type.type_id %}selected{%endif%}>{{property.title}} </option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <label class="col-2 col-form-label">Property Filters</label>
                                        <div class="col-10">                                        
                                            <select id="property_options"  multiple required id="property_options"  placeholder="Pick a tool..."></select>
                                         </div>
                                    </div>

        
                                    <div class="form-group row">
                                        <label class="col-2 col-form-label">Title</label>
                                        <div class="col-10">
                                            <input type="text" class="form-control" required id="title" name="title" placeholder="Some text value..." value="{{type.title}}">
                                        </div>
                                    </div>
                                  
                                    <div class="form-group row">
                                        <label class="col-2 col-form-label">sort</label>
                                        <div class="col-10">
                                            <input type="tel" class="form-control" required id="sort" name="sort" placeholder="Some text value..." value="{{type.sort}}">
                                        </div>
                                    </div>

                                    <div class="form-group mb-0 justify-content-end row">
                                        <div class="col-md-10">
                                            <button type="button" onclick="filter_add();" id="permission_add" class="btn btn-info waves-effect waves-light">Save</button>
                                        </div>
                                    </div>

                            </div>
                        </div>

                    </div>
                    <!-- end row -->

                </div>
                <!-- end card-box -->
            </div>
            <!-- end col -->
        </div>
        <!-- end row -->

    </div>
    <!-- end container -->
</div>
<!-- end wrapper -->
{% include "../../footer.html" %}

<!-- Parsleyjs -->
<script type="text/javascript" src="/assets/vendor/parsleyjs/dist/parsley.min.js"></script>
<script>
    // because 
    function filter_add()
    {
        // 2,4
        var data = $("#property_options").val() + "";
        
        $.post("/admincp/shop/typefilter/add",
            {
                id : $("#id").val(),
                type_id:$("#type_id").val(),
                title : $("#title").val(),
                property_options:data,
                sort:$("#sort").val()
            },
            function(data){
                window.location.href = "/admincp/shop/typefilters";
            }   
        );
    }
    function onUpdate(needItem)
    {
        $('#property_options')[0].selectize.clearOptions();
        $.get("/admincp/shop/typeproperty/list/" + $("#type_id").val(),
                function(data){
                    var arrs = JSON.parse(data);
                    for(var i = 0 ; i < arrs.length ; i++)
                        $('#property_options')[0].selectize.addOption(arrs[i]);

                    if (needItem)
                    {
                        var lst = '{{type.property_options}}'.split(',');
                        for(var i = 0 ; i < lst.length ; i++)
                        $('#property_options')[0].selectize.addItem(lst[i]);
                    }
                }
            );
       
    }

    $(document).ready(function() {
        $('form').parsley();
        $('#property_options').selectize({
            maxItems: null,
            valueField: 'id',
            labelField: 'title',
            searchField: 'title',
            options: [],
            create: false
        });
        onUpdate(true);
        
    });
</script>
